webpackJsonp([25],{"843Z":function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var s=n("0xDb"),i=n("vMJZ"),a={name:"BasicSettings",data:function(){return{changeInfo:!1,changePwd:!1,oldpwd:"",newpwd:"",name:"",eMail:"",phone:""}},methods:{editorialMaterials:function(){this.changeInfo=!0,this.changePwd=!1},changePassword:function(){this.changePwd=!0,this.changeInfo=!1},getUserInfo:function(){var t=this;Object(i.n)({}).then(function(e){"success"==e.result?(t.name=e.memberinfo.name,t.eMail=e.memberinfo.email,t.phone=e.memberinfo.mobile):t.$toast("请先登录")})},closeBtn:function(){this.changeInfo=!1,this.changePwd=!1},submit:function(t){13===t.keyCode&&this.submitPwd()},submitInfo:function(){var t=this;return""==this.name?(this.$toast("请输入昵称"),!1):""==this.phone?(this.$toast("请输入手机号"),!1):void Object(i.t)({mobile:this.phone,email:this.eMail,name:this.name,type:1}).then(function(e){"success"==e.result?(t.$store.dispatch("updateUserInfo"),t.changeInfo=!1,t.$toast(e.msg,"success"),t.$store.ready(function(e){t.isLogin=e.isLogin,1==t.isLogin?(t.name=e.userInfo.name,t.eMail=e.userInfo.email,t.phone=e.userInfo.mobile):t.$toast("请登录")})):t.$toast(e.msg)})},submitPwd:function(){var t=this;""!=this.oldpwd&&""!=this.newpwd?this.newpwd!=this.oldpwd?Object(i.t)({oldpwd:this.oldpwd,newpwd:this.newpwd,type:2}).then(function(e){"success"==e.result?t.$store.dispatch("updateUserInfo").then(function(){t.$toast("修改成功","success").then(function(){t.$router.push({name:"UserLogin"})})}):t.$toast(e.msg)}):this.$toast("新旧密码一致"):this.$toast("内容不能为空")},changeAvatar:function(){this.$refs.file_avatar.click()},uploadAvatar:function(t){var e=this;this.$showLoading(),Object(s.b)(this.$refs.file_avatar.files[0],{w:480,h:480}).then(function(t){var n=new FormData;n.append("file",t),Object(i.a)(n).then(function(t){"success"===t.result&&e.$store.dispatch("updateUserInfo").then(function(){e.$hideLoading()})})})}},activated:function(){var t=this;this.$store.ready(function(e){t.isLogin=e.isLogin,1==t.isLogin?(t.name=e.userInfo.name,t.eMail=e.userInfo.email,t.phone=e.userInfo.mobile):t.$toast("请登录")})}},o={render:function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",{staticClass:"basicSettings"},[t._m(0),t._v(" "),n("div",{staticClass:"basicSettings-main"},[n("div",{staticClass:"basicSettings-main__avatar"},[n("ks-image",{attrs:{src:t.$store.state.userInfo.headimg,type:"user",fit:"cover"}}),t._v(" "),n("el-button",{attrs:{size:"medium"},on:{click:t.changeAvatar}},[t._v("更换头像")]),t._v(" "),n("input",{ref:"file_avatar",staticStyle:{display:"none"},attrs:{type:"file"},on:{change:t.uploadAvatar}})],1),t._v(" "),n("div",{staticClass:"basicSettings-main__item"},[n("p",[t._v("账号：")]),t._v(" "),n("span",[t._v(t._s(t.$store.state.userInfo.username))]),t._v(" "),n("span",{staticClass:"ks-color-info",on:{click:t.editorialMaterials}},[t._v("编辑资料")])]),t._v(" "),n("div",{staticClass:"basicSettings-main__item"},[n("p",[t._v("昵称：")]),t._v(" "),t.changeInfo?n("el-input",{attrs:{placeholder:"请输入内容"},model:{value:t.name,callback:function(e){t.name=e},expression:"name"}}):n("span",[t._v(t._s(t.$store.state.userInfo.name))])],1),t._v(" "),n("div",{staticClass:"basicSettings-main__item"},[n("p",[t._v("邮箱：")]),t._v(" "),t.changeInfo?n("el-input",{attrs:{placeholder:"请输入内容"},model:{value:t.eMail,callback:function(e){t.eMail=e},expression:"eMail"}}):n("span",[t._v(t._s(t.$store.state.userInfo.email))])],1),t._v(" "),n("div",{staticClass:"basicSettings-main__item"},[n("p",[t._v("手机号：")]),t._v(" "),t.changeInfo?n("el-input",{attrs:{placeholder:"请输入内容"},model:{value:t.phone,callback:function(e){t.phone=e},expression:"phone"}}):n("span",[t._v(t._s(t.$store.state.userInfo.mobile))])],1),t._v(" "),t.changePwd?t._e():n("div",{staticClass:"basicSettings-main__item"},[n("p",[t._v("密码：")]),t._v(" "),n("span",[t._v("********")]),t._v(" "),n("span",{staticClass:"ks-color-info",on:{click:t.changePassword}},[t._v("修改密码")])]),t._v(" "),t.changePwd?n("div",{staticClass:"basicSettings-main__item"},[n("p",[t._v("旧密码：")]),t._v(" "),n("el-input",{staticStyle:{width:"120px"},attrs:{type:"password",placeholder:"请输入旧密码"},nativeOn:{keyup:function(e){return!e.type.indexOf("key")&&t._k(e.keyCode,"enter",13,e.key,"Enter")?null:t.submit(e)}},model:{value:t.oldpwd,callback:function(e){t.oldpwd=e},expression:"oldpwd"}})],1):t._e(),t._v(" "),t.changePwd?n("div",{staticClass:"basicSettings-main__item"},[n("p",[t._v("新密码：")]),t._v(" "),n("el-input",{staticStyle:{width:"120px"},attrs:{type:"password",placeholder:"请输入新密码"},nativeOn:{keyup:function(e){return!e.type.indexOf("key")&&t._k(e.keyCode,"enter",13,e.key,"Enter")?null:t.submit(e)}},model:{value:t.newpwd,callback:function(e){t.newpwd=e},expression:"newpwd"}})],1):t._e(),t._v(" "),t.changeInfo?n("div",{staticClass:"basicSettings-main__btn"},[n("el-button",{attrs:{type:"primary"},on:{click:t.submitInfo}},[t._v("确定")]),t._v(" "),n("el-button",{on:{click:t.closeBtn}},[t._v("取消")])],1):t._e(),t._v(" "),t.changePwd?n("div",{staticClass:"basicSettings-main__btn"},[n("el-button",{attrs:{type:"primary"},on:{click:t.submitPwd}},[t._v("确定")]),t._v(" "),n("el-button",{on:{click:t.closeBtn}},[t._v("取消")])],1):t._e()])])},staticRenderFns:[function(){var t=this.$createElement,e=this._self._c||t;return e("div",{staticClass:"basicSettings-top"},[e("h1",[this._v("基本设置")])])}]};var c=n("C7Lr")(a,o,!1,function(t){n("qx9k")},"data-v-44b9c04a",null);e.default=c.exports},qx9k:function(t,e){}});