webpackJsonp([21],{"5Twg":function(e,t,n){"use strict";t.g=function(e){return new a.a(function(t){Object(r.b)("Live.getLiveKey",e,{isErrorCall:!0}).then(function(e){t(e)})})},t.f=function(e){return new a.a(function(t){Object(r.b)("Live.getKeepChat",e).then(function(e){t(e)})})},t.i=function(e){return new a.a(function(t){Object(r.b)("Live.getStudentListBySID",e).then(function(e){t(e)})})},t.b=function(e){return new a.a(function(t){Object(r.b)("Live.addChat",e).then(function(e){t(e)})})},t.e=function(e){return new a.a(function(t){Object(r.b)("Live.editLiveSetting",e).then(function(e){t(e)})})},t.c=function(e){return new a.a(function(t){Object(r.b)("Live.delChat",e).then(function(e){t(e)})})},t.j=function(e){return new a.a(function(t){Object(r.b)("Live.joinLive",e).then(function(e){t(e)})})},t.d=function(e){return new a.a(function(t){Object(r.b)("Live.editBanned",e).then(function(e){t(e)})})},t.a=function(e){return new a.a(function(t){Object(r.b)("Live.addApply",e).then(function(e){t(e)})})},t.h=function(e){return new a.a(function(t){Object(r.b)("Live.getLiveStatus",e).then(function(e){t(e)})})},t.k=function(e){return new a.a(function(t){Object(r.b)("Live.pollThousand",e).then(function(e){t(e)})})};var i=n("rVsN"),a=n.n(i),r=n("60kx")},DljB:function(e,t,n){"use strict";var i=n("5Twg"),a={name:"SignForm",props:{formData:{type:Array,default:function(){return[]}}},methods:{isChecked:function(e,t){var n=!1;return e.map(function(e){e===t&&(n=!0)}),n?"sign-form__checkbox--checked":""},addCheck:function(e,t){var n=!1;e.map(function(i,a){i===t&&(n=!0,e.splice(a,1))}),n||e.push(t)},submit:function(){for(var e=this,t="",n=0;n<this.formData.length;n++){var a=this.formData[n];if(a.required){if(!a.value)return this.$toast("请先填写"+a.name),void("text"!==a.type&&"textarea"!==a.type||document.getElementById("sign-form-text"+n).focus());if("mobile"===a.field){if(!/^1[345789]\d{9}$/.test(a.value))return this.$toast("请输入正确的手机号码"),void document.getElementById("sign-form-text"+n).focus();t=a.value}}}var r=[];this.formData.map(function(e){r.push({name:e.name,key_value:e.value,type:e.type,field:e.field})}),Object(i.a)({courseid:this.$route.query.id,chapterid:this.$route.query.chapterid,mobile:t,json:r}).then(function(t){"success"===t.result?location.reload():e.$toast(t.msg)})}}},r={render:function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{staticClass:"sign-form"},[n("div",{staticClass:"sign-form__title"},[e._v("请先填写报名表单")]),e._v(" "),e._l(e.formData,function(t,i){return n("div",{key:i,staticClass:"sign-form__item"},[n("div",{staticClass:"sign-form__label"},[t.required?n("i",{staticClass:"sign-form__required ks-color-error"},[e._v("*")]):e._e(),e._v("\n      "+e._s(t.name)+"\n    ")]),e._v(" "),"text"===t.type?n("div",[n("input",{directives:[{name:"model",rawName:"v-model",value:t.value,expression:"item.value"}],staticClass:"sign-form__input",attrs:{type:"text",id:"sign-form-text"+i,placeholder:t.placeholder},domProps:{value:t.value},on:{input:function(n){n.target.composing||e.$set(t,"value",n.target.value)}}})]):"textarea"===t.type?n("div",{staticClass:"sign_textarea"},[n("textarea",{directives:[{name:"model",rawName:"v-model",value:t.value,expression:"item.value"}],staticClass:"sign-form__textarea",attrs:{id:"sign-form-text"+i,placeholder:t.placeholder},domProps:{value:t.value},on:{input:function(n){n.target.composing||e.$set(t,"value",n.target.value)}}})]):"radio"===t.type?n("div",e._l(t.content,function(i,a){return n("span",{key:a,staticClass:"sign-form__radio",class:t.value===i&&"sign-form__radio--checked",on:{click:function(e){t.value=i}}},[e._v(e._s(i))])}),0):"checkbox"===t.type?n("div",e._l(t.content,function(i,a){return n("span",{key:a,staticClass:"sign-form__checkbox",class:e.isChecked(t.value,i),on:{click:function(n){return e.addCheck(t.value,i)}}},[e._v(e._s(i))])}),0):e._e()])}),e._v(" "),n("ks-button",{staticClass:"sign-form__button",attrs:{type:"primary"},on:{click:e.submit}},[e._v("提交")])],2)},staticRenderFns:[]};var o=n("C7Lr")(a,r,!1,function(e){n("VDOq")},"data-v-39867898",null);t.a=o.exports},DokW:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=n("DljB"),a=n("5Twg"),r=null,o=null,s={name:"VLiveIndex",components:{SignForm:i.a},data:function(){return{step:0,courseCover:"",formData:[],polyvChatHeight:0,userid:0,liveType:0}},mounted:function(){var e=this;setInterval(function(){1==e.liveState&&3==e.liveType&&Object(a.k)({courseid:e.$route.query.id,chapterid:e.$route.query.chapterid,userid:e.userid}).then(function(e){})},3e5),window.onbeforeunload=function(t){1==e.liveState&&e.streamBilling(e.userid,2)}},activated:function(){var e=this;document.title="",this.liveType=0,this.step=0,this.userid=0,this.$nextTick(function(){Object(a.g)({courseid:e.$route.query.id,chapterid:e.$route.query.chapterid}).then(function(t){if(document.title=t.course_title,"success"===t.result)e.step=2,e.userid=t.userid,e.liveType=t.livetype,e.$nextTick(function(){if(r)e.createPolyvPlayer(t.userid,{uid:t.polyv.uid,vid:t.polyv.vid});else{var n=document.createElement("script");n.src="//player.polyv.net/livescript/liveplayer.js",document.body.appendChild(n),n.onload=function(){r=polyvObject,e.createPolyvPlayer(t.userid,{uid:t.polyv.uid,vid:t.polyv.vid})}}if(o)e.createPolyvChatRoom({vid:t.polyv.vid,userid:t.userid,username:t.username,avatar:t.avatar,token:t.polyv.token});else{var i=document.createElement("link");i.setAttribute("rel","stylesheet"),i.href="//player.polyv.net/jssdk/polyv-chatroom.min.css",document.head.appendChild(i),i.onload=function(){var n=document.createElement("script");n.src="//player.polyv.net/jssdk/polyv-chatroom.min.js",document.body.appendChild(n),n.onload=function(){o=PolyvChatRoom,e.createPolyvChatRoom({vid:t.polyv.vid,userid:t.userid,username:t.username,avatar:t.avatar,token:t.polyv.token})}}}});else switch(t.code){case"unbuy":e.$toast(t.msg).then(function(){e.$router.push({name:"CourseView",params:{id:e.$route.query.id}})});break;case"signform":e.courseCover=t.defaultpic,e.step=1,t.form.map(function(e){"checkbox"===e.type?e.value=[]:e.value=""}),e.formData=t.form}})})},methods:{updateLiveState:function(){var e=this;Object(a.h)({courseid:this.$route.query.id,chapterid:this.$route.query.chapterid}).then(function(t){"success"===t.result&&(e.liveState=t.status)})},createPolyvPlayer:function(e,t){var n=this,i=r(this.$refs.player).livePlayer({width:"100%",height:"100%",uid:t.uid,vid:t.vid,forceH5:!0}),a=!1,o=!1;window.s2j_onInitOver=function(t){i.on("s2j_onPlay",function(){a||(n.updateLiveState(),a=!0,n.streamBilling(e,1),setTimeout(function(){a=!1},1e3))}),i.on("s2j_onPause",function(){o||(n.updateLiveState(),o=!0,n.streamBilling(e,2),setTimeout(function(){o=!1},1e3))})}},createPolyvChatRoom:function(e){this.polyvChatHeight=window.innerHeight-this.$refs.player.offsetHeight,new o({roomId:e.vid,userId:e.userid,nick:e.username,pic:e.avatar,token:e.token,container:"#polyv-chat",width:"100%",height:"100%",userType:"",roomMessage:function(e){},enableSetNickname:!0,enableFlower:!1,enableLike:!1,tabData:[{name:"聊天",type:"chat"},{name:"在线",type:"user-list"}]})},streamBilling:function(e,t){var n=this;Object(a.j)({courseid:this.$route.query.id,chapterid:this.$route.query.chapterid,userid:e,type:t}).then(function(e){"error"===e.result&&n.$toast("计费失败，请尽快联系管理员")})}}},u={render:function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{staticClass:"v-live-index"},[1===e.step?n("div",[n("ks-image",{staticClass:"v-live-cover",attrs:{src:e.courseCover}}),e._v(" "),n("sign-form",{attrs:{"form-data":e.formData}})],1):2===e.step?n("div",[n("div",{ref:"player",staticClass:"v-live-index__player"}),e._v(" "),n("div",{style:{height:e.polyvChatHeight+"px"},attrs:{id:"polyv-chat"}})]):e._e()])},staticRenderFns:[]};var c=n("C7Lr")(s,u,!1,function(e){n("QmEZ")},"data-v-3eefcc1c",null);t.default=c.exports},QmEZ:function(e,t){},VDOq:function(e,t){}});